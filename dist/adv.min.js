
        

import { micromark } from 'https://esm.sh/micromark@3?bundle'
import { directive, directiveHtml } from 'https://esm.sh/micromark-extension-directive@3?bundle'


        

var book = {};
var scene = {};


        book.prologue=()=>(o("frog"),s(()=>"The frog glares angrily."),a(()=>"blah!",["frog"]),n("frog","Talk to frog",()=>(i(()=>"Frog is upset."),"\n\nThe frog doesn't want to talk right now.\n:topics\n\n    ")),n("please","Please Continue, Mr Barstow...",()=>l("title")),i(()=>"blah"),"\n\nAt my porch stood a small man in a tweed suit with a thick snow-colored\nmustache. “My name is Reginald Barstow,” he said. His voice tremored with\nfear. “Might I come in? I have a matter of the most \nstrange and unplesant circumstances. Please! No-one else will help me.”\n\n“Of course,” I said. I sat him down and presented him with a dram of\nsingle-malt scotch to calm his nerves, which he proceeded to sip greedily.\n\n“I am Madame Soo, Detective of Limehouse,” I said. “But you appear to have\nheard of me already.”\n\n“Yes,” he said. “I’ve come in my most desparete hour. I am being stalked,\nMadame, by forces not of this Earth!”\n\n“How very queer,” I said. He had the singular air of a man who had only\nnarrowly escaped the icy waves of the River Styx. His face was pale, and there\nwere thin crinkles around his reddish eyes. His pupils spoke of an abused\nliver.\n\n“I can assure you, you are quite safe here,” said I with no small confidence.\n“But for my own enlightenment, please tell me: who is after you?”\n\nHe swallowed the entirety of his drink. “I tell you, Madame, and you must\npromise to believe me. I am being hunted by none other than the Egyptian\nGod of Death!”\n\n:::aside\nType :kbd[please] to continue.\n:::\n\n"),book.title=()=>(n("no","No no no",()=>"Noooo!!"),n("frog","Hello Frog",()=>"\n\nThe frog isn’t speaking to you.\n:restricted\n\n"),n("hello","Hello World",()=>"Hello back."),r(["yes","hello","frog"]),"\n\n# The Penumbra of Anubis\n### a game by spacflounder\n\n:::dropcap\nYou present an interesting case,” said I with no small hint of delight.\n“You believe, with the most dire sincerity, that you are in fact hunted\nby none other than Anubis himself?”\n:::\n\n“With all my soul!” said Barstow. “The priests won’t help me, and I dare not\ngo to Scotland Yard. Please, Madame Soo, I gravely require you to shed\nsome light on this darkness I find myself ensconced in.”\n\n");const e={title:"The Penumbra of Anubis",author:"spaceflounder",email:"spaceflounder@hotmail.com",firstPage:"intro"};book.intro=()=>(n("start","Head to the Cliffside",()=>l("cliffside")),n("ding","And who exactly is Aunt Ding?",()=>l("ding")),"\n\n### Because I Play Applesauce\n\n:::dropcap\nNone of the kids at my school had ever heard of Applesauce. I mean the\ncard game, not the food. But Gladys had. We played together on recess,\nin between wallball and hiding from bullies like Tom Dogger.\n:::\n\nThen one day she invited me to visit her Aunt Ding.\n\n:::aside\nType :kbd[ding] to continue, or, if you‘ve played before, type :kbd[start] to\nskip straight to the cliffside.\n:::\n\n");let n=(e,n,t)=>{},t=(e,n,t)=>{},o=e=>{},i=e=>{},a=(e,n)=>{},s=e=>{},r=e=>{},c=()=>{},l=e=>{},d=e=>"",u=(e,n)=>{};!function(){let t=[],c={page:"",topics:[]};const u={},h={};let p=()=>{},m={},f="",g={},y={},w="",b=[],k=[];function v(e){return e.replace(/ /g,"")}function I(e){const n=d();return`${c.page??"default"}-${n}`}function T(e){const n=d();return`${c.page??"default"}-${n}${f?"-"+f:""}`}function $(e){e=e.split("\n").map(e=>e.trim()).join("\n");const n=document.createElement("div");n.className="pr";const o=micromark(e,{extensions:[directive()],htmlExtensions:[directiveHtml({dropcap:function(e){const n=e.content.replace("<p>","").replace("</p>","");this.tag('<div class="drop-cap">'),this.tag(n),this.tag("</div>")},aside:function(e){const n=e.content.replace("<p>","").replace("</p>","");this.tag("<aside>"),this.tag(n),this.tag("</aside>")},kbd:function(e){const n=e.label;this.tag("<kbd>"),this.tag(n),this.tag("</kbd>")},topics:function(e){const n=function(){const e=[...c.topics.map(e=>{if(g[e])return`<kbd>${e}</kbd>`}).filter(e=>e)];if(1===c.topics.length)return`You might talk\n            about ${e.pop()}.`;if(2===c.topics.length){const n=e.pop();return`You might talk \n            about ${e.pop()} or ${n}`}if(c.topics.length>2){const n=e.pop();return`You might\n            discuss ${e.join(", ")} or ${n}.`}return""}();n&&(this.tag("<aside>"),this.tag(n),this.tag("</aside>"))},restricted:function(e){const n=function(){const e=[...k.map(e=>{if(g[e])return`<kbd>${e}</kbd>`}).filter(e=>e)];if(1===k.length)return`You can type ${e.pop()}.`;if(2===k.length){const n=e.pop();return`You can type ${e.pop()} or ${n}`}if(k.length>2){const n=e.pop();return`You can type ${e.join(", ")} or ${n}.`}return""}();n&&(this.tag("<aside>"),this.tag(n),this.tag("</aside>"))}})]});n.innerHTML=o,t.push(n)}function E(){const e=document.getElementById("output"),n=document.getElementById("preview"),o=document.createElement("div");o.className="response",o.append(...t),t=[],n.innerHTML="",e.append(o);const i=o.getBoundingClientRect();window.scrollTo(0,i.top+window.scrollY)}function B(e){e.preventDefault();const n=document.getElementById("command-line"),t=n.value.trim().toLowerCase();if(g[t]){const[e,o]=g[t];f=t;let i=o();const a=(()=>{const e=T();if(h[e]&&-1!==h[e]){const n=h[e]();return h[e]=-1,n}})();if(a&&(i=a),function(){const e=I();return!(!u[e]||!u[e].callback)}()){const e=I();if(u[e].cmds.indexOf(t)>-1){i=(e=>`\n\n${u[e].callback()}\n\n`)(e)+i,u[e].callback=!1}}if(k.length>0){const e={...g};g={},k.map(n=>g[n]=e[n])}$(((e,n)=>`\n\n### ${e}            \n\n${n}\n\n`)(e,i)),E(),f="",n.value=""}return n.focus(),!1}d=e=>{const n=e||c.page;return m[n]??"default"},(e,n)=>{const t=n||c.page;m[t]=e},n=(e,n,t)=>{const o=v(e.toLowerCase().trim());g[o]=[n,t]},(e,n,t)=>{const o=v(e.toLowerCase().trim());y[o]=[n,t]},r=e=>{k=[...e]},i=e=>{const n=T();h[n]||(h[n]=e)},o=e=>{const n=new Set([...c.topics,e]);c.topics=[...n]},s=e=>{b=[e,void 0]},l=e=>{let n="";g={},p=book[e],c.page=e,n=p();const t=b.pop();return t?t()+n:n},a=(e,n)=>{const t=I();u[t]||(u[t]={cmds:[...n],callback:e})},()=>c,addEventListener("load",()=>{document.title=e.title,function(){const e=document.getElementById("output"),n=document.getElementById("input");e&&(e.innerHTML=""),n&&(n.onsubmit=B)}(),function e(){const n=document.getElementById("preview"),t=document.getElementById("command-line").value;if(g[t]){const e=g[t][0];if(e&&w!==e){n.innerText="";const t=document.createElement("div");w=e,t.className="preview-content",t.append(e),n.append(t)}}else n.innerText="",w="";setTimeout(()=>{e()},100)}(),$(l(e.firstPage)),E()}),addEventListener("keyup",e=>{const n=document.getElementById("command-line"),t=e.key.toLowerCase();"arrowup"===t?window.scrollTo(0,window.scrollY-50):"arrowdown"===t?window.scrollTo(0,window.scrollY+50):n&&document.activeElement!==n&&("abcdefghijklmonpqrstuvwxyz".indexOf(t)>-1&&(n.value+=t),n.focus())})}();
    